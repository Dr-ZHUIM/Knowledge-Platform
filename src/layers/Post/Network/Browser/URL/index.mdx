import blockShaft from '@imgs/article/Network/process.jpg';

export var label = `输入URL行为的影响`;
export var summary = '本文将讨论一个经典问题 😊 当输入URL后会发生什么';

# 输入 URL 行为的影响

本文将讨论一个经典问题 😊 当输入 URL 后会发生什么，这是一个能够很好检验 Web 开发工程师水平的问题。

## 进程协同

这里可以看一张具体的流程图,可以用于更好的理解。

<Image width={'100%'} src={blockShaft} />

可以在整个过程中有多个进程参与工作，这里一起了解一下主要进程的职责

1. `浏览器进程` 主要负责用户交互、子进程管理、文件储存等工作：包括地址栏，书签栏，前进后退按钮等部分的工作；负责处理浏览器的一些不可见的底层操作，比如网络请求和文件访问；

   1. `UI线程` 负责控制浏览器本身的按钮及输入框；

   2. `储存器线程` 负责控制文件等的访问；

2. `网络进程` 负责对浏览器进程与渲染进程提供网络连接与网络下载功能

3. `渲染进程` 负责单个 tab 中网页呈现的内容：把从网络下载的 HTML、JavaScript、CSS、图片等资源解析为可以显示和交互的页面。

## 具体过程

### 处理输入

UI 线程判断用户输入的是 query 还是 URL，如果是 query 则拼接 URL，否则访问 URL

### 查询缓存

1. `浏览器进程`将判断被查询的 URL 是否存在 301 一类已记录数据，若有则进行重定向操作

2. 浏览器通过**IPC 通信**通知`网络进程`发起请求获取网页内容，tab 页标签开始 loading 动画

3. 网络进程首先查找`浏览器缓存`，如果请求资源已被缓存，同时服务器资源没有修改，直接使用缓存资源，达到减少服务器请求的目的

> 如果使用缓存资源的话，server 会显示该资源返回 status_code 为 304

### DNS 解析

DNS 解析就是指将域名解析为服务器 IP 地址的过程

浏览器如何通过域名去查询 URL 对应的 IP 呢？

查询过程：

1. 浏览器缓存：浏览器会按照一定的频率缓存 DNS 记录，若无则下一步
2. 操作系统缓存：如果浏览器缓存中找不到需要的 DNS 记录，那就去操作系统中找，若无则下一步
3. 路由缓存： 路由器也有 DNS 缓存，若无则下一步
4. ISP（Internet Server Provider）拥有专门 DNS 服务器用以查找，若无则下一步
5. 查看本地 HOST 文件，若无则下一步
6. 在本地域名服务器进行递归查找，最终将查询的 IP 结果给 DNS 解析器
7. 根据根域名服务器 -> 顶级域名服务器 -> 域的域名服务器的顺序进行迭代查询。

### TCP 连接

找到对于 IP 后需要进行三次握手，创建 TCP 链接，如果是 https 连接，要在 tcp 三次握手之后创建加密连接，来加密通信的上层数据（建立 SSL/TLS 连接）

> TCP 三次握手
>
> 1. 第一次握手: 建立连接，客户端 A 发送 SYN=1、随机产生 Seq=client_isn 的数据包到服务器 B，等待服务器确认。
>
> 2. 第二次握手: 服务器 B 收到请求后确认联机(可以接受数据)，发起第二次握手请求，ACK=(A 的 Seq+1)、SYN=1，随机产生 Seq=client_isn 的数据包到 A。
>
> 3. 第三次握手: A 收到后检查 ACK 是否正确，若正确，A 会在发送确认包 ACK=服务器 B 的 Seq+1、ACK=1，服务器 B 收到后确认 Seq 值与 ACK 值，若正确，则建立连接。

### 发送 HTTP/HTTPS 请求

### 服务器处理请求并返回 HTTP/HTTPS 报文

### 浏览器解析渲染页面

### 连接结束
